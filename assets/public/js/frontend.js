(()=>{"use strict";var t=wp.i18n.__;jQuery((function(a){a(".field-type-date").length&&a.fn.datepicker&&a(".field-type-date input").datepicker({dateFormat:"yy/mm/dd",changeYear:!0,changeMonth:!0,yearRange:"1950:2020",defaultDate:new Date(2e3,0,1),beforeShow:function(t,a){setTimeout((function(){a.dpDiv.addClass("lemonway-datepicker")}),0)}}),{init:function(){return this.attachEventListeners(),this.toggleAccount(),this.deactivateLinkAccount(),!1},deactivateLinkAccount:function(){this.handleDeactivateClick(),this.handleModalCloseClick(),this.handleDeactivationConfirmation()},handleDeactivateClick:function(){var t=this;a(document).on("click",".link-account-deactivate",(function(e){e.preventDefault();var n=a(e.currentTarget).data("id");t.toggleModal(!0),a("#lemonway-iban-deactivation").data("id",n)}))},handleModalCloseClick:function(){var t=this;a("#lemonway-modal-close").on("click",(function(a){a.preventDefault(),t.toggleModal(!1)}))},handleDeactivationConfirmation:function(){var t=this;a("#lemonway-iban-deactivation").on("click",(function(e){e.preventDefault();var n=a(e.currentTarget).data("id");t.showLoadingState(),t.deactivateAccount(n,e)}))},deactivateAccount:function(t,e){var n=this;a.ajax({url:ajaxObj.ajaxUrl,type:"POST",data:{action:"lemonway_deactivate_link_bank_account",iban_id:t,nonce:ajaxObj.security},success:function(t){return n.handleDeactivationResponse(t,e)},error:function(){return n.handleDeactivationError()}})},handleDeactivationResponse:function(t,e){this.hideLoadingState(),t.success?(a(e.target).remove(),a("#lemonway-modal-close").text("Close"),this.updateModalContent(t.data.message)):this.updateModalContent(t.error)},handleDeactivationError:function(){this.updateModalContent(t("An error occurred while deactivating.","lemonway"))},updateModalContent:function(t){a("#lemonway-modal .modal-content").html(t),this.toggleModal(!0)},showLoadingState:function(){a("#lemonway-modal .modal-content").html('<div class="loading-spinner">'+t("Loading &hellip;","lemonway")+"</div>")},toggleModal:function(t){a("#lemonway-modal").toggleClass("active",t)},hideLoadingState:function(){a("#lemonway-modal .modal-content").html("")},toggleAccount:function(){a(".lemonway-settings-account-type-fields input").on("click",(function(){a(".lemonway-settings-company-fields").toggleClass("lemonway-hide","individual"===a(this).val())}))},attachEventListeners:function(){var t=this;a(".lemonway-save-dokan-btn").on("click",(function(e){var n;e.preventDefault();var o=a(e.currentTarget),i=o.closest("form"),d=i.attr("id"),c=null!==(n=i.attr("lemonway-action"))&&void 0!==n?n:o.attr("data-action");t.submitSettings(d,c)})),a(".lemonway-disconnect-dokan-btn").on("click",(function(e){e.preventDefault();var n=a(e.currentTarget).closest("form"),o=n.attr("id");a(":input",n).not(":button, :submit, :reset, :hidden, :checkbox").val("").prop("selected",!1),t.submitSettings(o,"disconnect",!0)}))},submitSettings:function(t,e,n){var o=a("form#".concat(t)),i=new FormData(o[0]);i.append("action","lemonway_dokan_settings"),i.append("form_id",t),i.append("form_step",e),this.handleRequest(o,i,e,n)},handleRequest:function(t,e,n,o){var i='<span class="dokan-loading"></span>';o?t.find(".ajax_prev.disconnect").append(i):t.find(".ajax_prev.save").append(i),a.ajax({type:"POST",url:ajaxObj.ajaxUrl,data:e,dataType:"json",processData:!1,contentType:!1,enctype:"multipart/form-data",success:function(e){e.success?(e.data.btn_text&&t.find(".lemonway-save-dokan-btn").text(e.data.btn_text),"verification"===e.data.form_step?(t.find("#form-input-birthDateVerify").closest(".lemonway-hide").removeClass("lemonway-hide"),t.attr("lemonway-action","verification")):"verified"===e.data.form_step?(e.data.redirect_url&&setTimeout((function(){window.location.href=e.data.redirect_url}),1e3),t.attr("lemonway-action","step1")):"step2"===e.data.form_step?(t.find(".step.step1").addClass("lemonway-hide"),t.find(".step.step2").removeClass("lemonway-hide"),t.attr("lemonway-action","step2")):"step3"===e.data.form_step?(t.find(".step.step2").addClass("lemonway-hide"),t.find(".step.step3").removeClass("lemonway-hide"),t.attr("lemonway-action","step3")):"completed"===e.data.form_step?(t.attr("lemonway-action","step1"),e.data.redirect_url&&setTimeout((function(){window.location.href=e.data.redirect_url}),1e3)):"bank_link"===e.data.form_step&&(t.attr("lemonway-action","bank_link"),e.data.redirect_url&&setTimeout((function(){window.location.href=e.data.redirect_url}),1e3)),a(".dokan-ajax-response").html(a("<div/>",{class:"dokan-alert dokan-alert-success",html:"<p>"+e.data.msg+"</p>"}))):a(".dokan-ajax-response").html(a("<div/>",{class:"dokan-alert dokan-alert-danger",html:"<p>"+e.data+"</p>"}))},error:function(t,e,n){a(".dokan-ajax-response").html(a("<div/>",{class:"dokan-alert dokan-alert-danger",html:"<p>Ajax Error: "+n+"</p>"}))},complete:function(){t.find("span.dokan-loading").remove(),a("html,body").animate({scrollTop:a(".dokan-dashboard-header").offset().top})}})}}.init()}))})();